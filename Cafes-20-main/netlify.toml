# =========================
# Netlify Configuration for Monorepo
# =========================
# CRITICAL: This file MUST be in the repository root
# Netlify dashboard settings will be IGNORED if this file exists

[build]
  # Base directory: ROOT (where package.json with Vite is located)
  # DO NOT set to "client" - that's where the error comes from
  base = "."
  
  # Build command: Use the script from ROOT package.json
  command = "npm ci && npm run build:client"
  
  # Publish directory: Vite outputs to dist/spa (from vite.config.ts)
  # Path is relative to base directory
  publish = "dist/spa"
  
  # Ignore builds for server changes only
  ignore = "git diff --quiet $CACHED_COMMIT_REF $COMMIT_REF -- server/"

# Environment variables
[build.environment]
  NODE_VERSION = "22"
  # Use npm ci for faster, more reliable installs
  NPM_FLAGS = "--legacy-peer-deps"
  # Ensure devDependencies are installed (they are by default, but explicit is better)
  NODE_ENV = "development"

# SPA routing: Redirect all routes to index.html
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Headers for security and performance
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
